@{
    ViewData["Title"] = "Generate Study Guide";
}

<body class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900">

    <!-- Animated Background -->
    <div class="pointer-events-none fixed inset-0 opacity-20">
        <div class="absolute top-0 left-1/4 h-96 w-96 animate-pulse rounded-full bg-blue-900/30" style="animation-duration: 8s;"></div>
        <div class="absolute right-1/4 bottom-1/4 h-96 w-96 animate-pulse rounded-full bg-teal-500/20" style="animation-duration: 12s; animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 h-96 w-96 animate-pulse rounded-full bg-blue-800/20" style="animation-duration: 10s; animation-delay: 4s;"></div>
    </div>

    <div class="relative z-10 flex min-h-screen flex-col">


        <!-- Main Content Area -->
        <main class="flex-1">
            <div class="mx-auto max-w-5xl px-6 py-12">

                <!-- Input Section -->
                <div class="mb-12">
                    <div class="mb-8 text-center">
                        <h1 class="mb-3 text-4xl font-bold text-blue-900 md:text-5xl">
                            Generate Your <span class="text-teal-500">Study Guide</span>
                        </h1>
                        <p class="mx-auto max-w-2xl font-sans text-lg text-slate-600">
                            Paste a YouTube lecture URL below and we'll transform it into a comprehensive, structured study guide
                        </p>
                    </div>

                    <!-- Input Card -->
                    <div class="rounded-2xl border border-slate-200 bg-white p-8 shadow-lg">
                        <form id="generate-guide-form" class="space-y-6">
                            <div>
                                <label for="youtube-url" class="mb-2 block font-sans text-sm font-semibold text-slate-700">
                                    YouTube Video URL
                                </label>
                                <div class="flex items-center gap-2 rounded-lg border border-slate-300 bg-slate-50 px-4 py-3 transition-colors focus-within:border-blue-900 focus-within:bg-white">
                                    <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                    </svg>
                                    <input 
                                        type="url"
                                        id="youtube-url"
                                        name="youtubeUrl"
                                        placeholder="https://youtube.com/watch?v=..."
                                        class="placeholder-slate-400 flex-1 bg-transparent font-sans text-slate-900 focus:outline-none"
                                        required />
                                </div>
                                <p class="mt-2 font-sans text-xs text-slate-500">
                                    Example: https://youtube.com/watch?v=dQw4w9WgXcQ
                                </p>
                            </div>

                            <div class="flex items-center justify-between gap-4 border-t border-slate-200 pt-6">
                                <div class="flex items-center gap-2 font-sans text-sm text-slate-600">
                                    <svg class="h-4 w-4 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                    <span>Powered by Claude AI</span>
                                </div>
                                <button 
                                    type="submit"
                                    class="group flex items-center gap-2 rounded-lg bg-amber-500 px-8 py-3.5 font-sans text-base font-semibold text-white transition-all hover:bg-amber-600 hover:shadow-lg hover:shadow-amber-500/30">
                                    <span>Generate Study Guide</span>
                                    <svg class="h-5 w-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Output Section -->
                <div id="output-section" class="hidden">
                    <!-- Loading State -->
                    <div id="loading-state" class="hidden rounded-2xl border border-slate-200 bg-white p-12 text-center shadow-lg">
                        <div class="mb-6 flex justify-center">
                            <div class="h-16 w-16 animate-spin rounded-full border-4 border-slate-200 border-t-teal-500"></div>
                        </div>
                        <h3 class="mb-2 text-xl font-bold text-blue-900">Generating Your Study Guide</h3>
                        <p class="font-sans text-slate-600">Analyzing lecture content and structuring key concepts...</p>
                    </div>

                    <!-- Output Display -->
                    <div id="guide-output" class="hidden">
                        <div class="mb-6 flex items-center justify-between">
                            <div>
                                <h2 class="mb-2 text-3xl font-bold text-blue-900">Study Guide Generated</h2>
                                <p class="font-sans text-sm text-slate-600">
                                    <span id="video-title">Video Title</span> • <span id="generation-time">Generated just now</span>
                                </p>
                            </div>
                            <div class="flex gap-3">
                                <button id="copy-btn" class="flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 font-sans text-sm font-semibold text-slate-700 transition-all hover:border-blue-900 hover:bg-slate-50">
                                    Copy
                                </button>
                                <button id="download-btn" class="flex items-center gap-2 rounded-lg bg-teal-500 px-4 py-2 font-sans text-sm font-semibold text-white transition-all hover:bg-teal-600 hover:shadow-lg">
                                    Download
                                </button>
                            </div>
                        </div>

                        <!-- Guide Content -->
                        <div class="rounded-2xl border border-slate-200 bg-white shadow-lg">
                            <div class="prose prose-slate max-w-none p-8 md:p-12 lg:p-16">
                                <div id="guide-content">
                                    <p class="text-slate-600">Your generated guide will appear here...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

    </div>

    <!-- JS AJAX + Copy/Download -->
    <script>
        const form = document.getElementById('generate-guide-form');
        const outputSection = document.getElementById('output-section');
        const loadingState = document.getElementById('loading-state');
        const guideOutput = document.getElementById('guide-output');
        const guideContent = document.getElementById('guide-content');
        const videoTitle = document.getElementById('video-title');
        const generationTime = document.getElementById('generation-time');
        const copyBtn = document.getElementById('copy-btn');
        const downloadBtn = document.getElementById('download-btn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const youtubeUrl = document.getElementById('youtube-url').value;

            outputSection.classList.remove('hidden');
            loadingState.classList.remove('hidden');
            guideOutput.classList.add('hidden');

            try {
                const res = await fetch('/Guide/GenerateGuide', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ youtubeUrl })
                });

                if (!res.ok) throw new Error('Failed to generate guide');

                const data = await res.json();
                guideContent.innerHTML = data.html;
                videoTitle.textContent = data.videoTitle;
                generationTime.textContent = data.generationTime;

                loadingState.classList.add('hidden');
                guideOutput.classList.remove('hidden');

            } catch (err) {
                loadingState.innerHTML = `<p class="text-red-500">Error: ${err.message}</p>`;
            }
        });

        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(guideContent.innerText);
            alert('Copied to clipboard!');
        });

        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([guideContent.innerText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study-guide.txt';
            a.click();
            URL.revokeObjectURL(url);
        });
    </script>

</body>
